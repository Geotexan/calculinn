<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <style>
            div.cell_referencia     {background-color: lightgreen;}
            div.cell_recomendado    {background-color: yellow;}
        </style>
        <script type="text/javascript" src="brython.js"></script>
        <title>Prueba muros</title>
    </head>
    <body onload="brython()">
        <!-- <script type="text/python" src="muros.py"></script> -->
        <!-- <script type="text/python" src="motor.py"></script> -->
        <script type="text/python">
            from carreteras_pg3_recomendador import CABECERA, TABLA
            from carreteras_pg3_recomendador import NUMENTRADAS, NUMSALIDAS
            from carreteras_pg3_calculo import TABLA as CALCULO
            from motor import recomendar, calcular
            from browser import document as doc
            from browser import alert
            from browser import html

            def dump_calculo(out):
                """
                Recibe la fila completa del resultado del cálculo.
                Muestra los valores de referencia con los que se ha
                comparado (In) y los valores calculados para los
                parámetros de salida (Out) que definirán el producto a
                recomendar.
                """
                # Primero los valores de referencia que han sido activados por
                # los parámetros de entrada (los del formulario `entrada`).
                #print("Valores de referencia usados:")
                ths = []
                tds = []
                for i in range(NUMENTRADAS):
                    nombre = CABECERA[i]
                    valor = out[i]
                    #print(nombre, valor)
                    ths.append(nombre)
                    tds.append(html.DIV(valor, Class="cell_referencia"))
                # Ahora los valores calculados para esas entradas
                #print("Valores calculados que debe satisfacer el producto:")
                for i in range(NUMENTRADAS, NUMENTRADAS + NUMSALIDAS - 1):
                    # -1 porque la fila lleva también el producto como
                    # referencia interna para depuración, pero no se debe
                    # mostar. Aunque debe ser el mismo que da el recomendador.
                    nombre = CABECERA[i]
                    valor = out[i]
                    #print(nombre, valor)
                    ths.append(nombre)
                    tds.append(valor)
                # La fila de la tabla de cabecera, los nombres de los paráms.
                try:
                    row = html.TH(ths[0])
                except IndexError: # Sin valores para mostrar.
                    pass
                else:
                    for th in ths[1:]:
                        row += html.TH(th)
                    doc["referencia"] <= html.TR(row)
                # La fila de los valores: los de referencia y los calculados.
                try:
                    row = html.TD(tds[0])
                except IndexError:  # Sin valores para mostrar.
                    pass
                else:
                    for td in tds[1:]:
                        row += html.TD(td)
                    doc["referencia"] <= html.TR(row)

            def dump_recomendacion(out):
                """
                Recibe la tupla «out» e inyecta en el HTML los resultados
                con sus etiquetas.
                """
                ths = []
                tds = []
                # Pongo los valores del producto recomendado que satisfacen
                # los valores calculados:
                #print("Cracterísticas del producto recomendado:")
                for i in range(NUMENTRADAS, NUMENTRADAS + NUMSALIDAS - 1):
                    # -1 porque al producto le voy a aplicar otro estilo.
                    nombre = CABECERA[i]
                    valor = out[i]
                    #print(nombre, valor)
                    ths.append(nombre)
                    tds.append(valor)
                try:
                    nombre = CABECERA[-1]
                    valor = out[-1]
                except IndexError:  # ¿No hay datos?
                    pass
                else:
                    ths.append(nombre)
                    tds.append(html.DIV(valor, Class="cell_recomendado"))
                # La fila de la tabla de cabecera, los nombres de los paráms.
                try:
                    row = html.TH(ths[0])
                except IndexError: # Sin valores para mostrar.
                    pass
                else:
                    for th in ths[1:]:
                        row += html.TH(th)
                    doc["producto"] <= html.TR(row)
                # La fila de los valores: los de referencia y los calculados.
                try:
                    row = html.TD(tds[0])
                except IndexError:  # Sin valores para mostrar.
                    pass
                else:
                    for td in tds[1:]:
                        row += html.TD(td)
                    doc["producto"] <= html.TR(row)

            def calculate(ev):
                args = []
                for i in range(NUMENTRADAS):
                    inputvalue = doc["in%d" % i].value
                    if inputvalue.strip() == "":
                        alert("Debe espeficiar un valor para {}.".format(
                            CABECERA[i]))
                    else:
                        args.append(inputvalue)
                #print(args)
                if len(args) == NUMENTRADAS:
                    out_calculo = calcular(CALCULO, *args)
                    if not out_calculo:
                        alert("No se pudieron realizar los cálculos.\n"
                              "Los parámetros de entrada no son válidos.")
                    else:
                        # print(out_calculo)
                        dump_calculo(out_calculo)
                        out_recomendacion = recomendar(TABLA, *args)
                        # print(out_recomendacion)
                        if not out_recomendacion:
                            alert("No se encontró producto.\n"
                                  "Los parámetros de entrada no son válidos.")
                        else:
                            dump_recomendacion(out_recomendacion)

            ##########################
            # Construyo el formulario:
            elementos = []
            for i in range(NUMENTRADAS):
                elementos.append(html.LABEL(CABECERA[i] + ": "))
                elementos.append(html.INPUT(type="text", id="in%d" % i))
                elementos.append(html.BR())
            elementos.append(html.BUTTON("Calcular", id="bcalcular",
                             form=None))
            for elemento in elementos:
                doc["entradas"] <= elemento
            doc["bcalcular"].bind("click", calculate)
        </script>
        <h1>Test muros</h1>
        <form id="entradas">
            <!-- <input id="e" type="text" name="e">
            <input id="a" type="text" name="a">
            <input id="h" type="text" name="h">
            <input id="i" type="text" name="i">
            <input id="d" type="text" name="d">
            <input id="s" type="text" name="s"> -->
            <!-- <button id="bcalcular">Calcular</button> -->
        </form>
        <div id="salida">
            <h2>Valores de referencia y calculados:</h2>
            <table id="referencia">
            </table>
            <h2>Producto recomendado:</h2>
            <table id="producto">
            </table>
        </div>
    </body>
</html>
